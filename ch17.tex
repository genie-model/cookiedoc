%----------------------------------------------------------------------------------------
%       CHAPTER 17
%----------------------------------------------------------------------------------------

\cleardoublepage

%\chapterimage{Map_of_Earth_24.jpg} % Chapter heading image

\chapter{muffingen}\label{ch:muffingen}

\hfill \break
\vspace{24mm}

%------------------------------------------------
\newpage
%------------------------------------------------

\section{muffingen basics}

%------------------------------------------------

\subsection{overview of the muffingen software}

\textbf{muffingen} is a collection of \textbf{MATLAB}\footnote{As a \textbf{MATLAB} code, (only) very basic familiarity with using \textbf{MATLAB} at the command line is required. And a copy/license of the \textbf{MATLAB} software ... A sufficient grasp of \textbf{MATLAB} can be gained by going through the following sections/subsections of the \textsf{matlabananas} textbook, which can be found on \href{https://github.com/derpycode/matlabananas}{GitHub} (look for the PDF file compiled form the latex source -- \textsf{BANANAS.pdf}):
\vspace{1mm}
\begin{itemize}[noitemsep]
\item Section 1.1 -- The \textbf{MATLAB} interface and command line.
\item Section 1.6 -- Changing directories and file search paths.
\item Section 2.2 -- Using \textit{functions} ... of which \texttt{muffingen} is one.
\end{itemize}
} functions that can create all the primary configuration files required by the cGENIE (\textbf{muffin}) Earth system model. \textbf{muffingen} was originally designed to take the output from a fully coupled GCM, particularly of past climates with different continental configurations, and then re-grid the output needed by the \textbf{muffin} model (in the form of files of boundary conditions, all  saved  in their respective correct format). However, \textbf{muffingen} can also be used to 'draw' conceptual alternative Earths (in terms of continental configuration). Again, saving the required \textbf{muffin} files in their appropriate formats.

%------------------------------------------------

\subsection{Installing muffingen}

The \textbf{muffingen} code is hosted on GitHub:

\vspace{2mm}
\href{https://github.com/derpycode/muffingen}{\texttt{https://github.com/derpycode/muffingen}}
\vspace{2mm}

There are 2 ways to get your mitts on the \textbf{muffingen} code:

\vspace{2mm}
\begin{enumerate}

\vspace{1mm}
\item By downloading an archive file, containing all the code etc. For this -- click on the \textcolor[rgb]{0,0.501961,0}{green} \textsf{\small{Clone or Download}} button, and select \textsf{\small{Download ZIP}}.
\\You then unpack/unzip the files and directory structure where you want it.
\\This [archive download] is the simplest and  perfectly workable way to proceed\footnote{Note that this way, you will be unable to easily update the code with whatever new developments or bug fixes occur in the future, nor can propagate back any code changes that you might have made and might want to become part of the official \textbf{muffingen} code  (i.e. downloading the \textsf{zip} file becomes a one-off installation that loses its formal connection to the GitHub repository).} (and is the recommended option).

\vspace{1mm}
\item Or you can \textit{clone} the repository to where you intend to run \textbf{muffingen}. Note that you will need a git client installed on your computer. There are GUI clients for git, or this can be done at the command line:

\vspace{-2mm}
\begin{verbatim}
$ git clone https://github.com/derpycode/muffingen.git
\end{verbatim}
\vspace{-2mm}

By doing this, you have created your own code repository (and an identical copy of the one hosted on GitHub). As part of the \texttt{git clone} command, you also automatically \textit{check out} (from your very own personal repository) a copy of the code.

\end{enumerate}
\vspace{2mm}

Note that you download or clone \textbf{muffingen} to the computer that you have \textbf{MATLAB} installed on and will use to run \textbf{muffingen} (i.e. not necessarily to the computer where \textbf{muffin} itself is run).

%------------------------------------------------

\newpage

\subsection{Running muffingen}

To use the \textbf{cGENIE.muffin} model configuration generator \textbf{muffingen} -- at the command line in \textbf{MATLAB}, simply type:

\vspace{-2mm}
\begin{verbatim}
>> muffingen('FILENAME')
\end{verbatim}
\vspace{-2mm}

\noindent where \texttt{FILENAME} is the name of an ASCII  (plain text) format configuration file (having a \texttt{.m} filename extension) that specifies the required settings (see subsequent section).

This file (\texttt{FILENAME.m}), must either be present in the directory where you installed \textbf{muffingen} (the directory where e.g. where the file \texttt{muffingen.m} is located) e.g. \textsf{C:\textbackslash muffingen}. In this case, your \textbf{MATLAB} working directory must also be  set to \textsf{C:\textbackslash muffingen}. Or, the \textbf{MATLAB} working directory and the file \texttt{FILENAME.m} can reside elsewhere. In this case, you will then 'add' the location of \textbf{muffingen} to \textbf{MATLAB}'s search path by the \textbf{MATLAB} function \texttt{addpath}\footnote{Refer to the \textbf{MATLAB} '\textsf{bananas}' text for the syntax for using \texttt{addpath}.}.

The \textbf{muffingen} model configuration generator then starts, and depending on the specific settings in the configuration file, may require no user input, or may require user input (either because this option was requested, or because a re-gridding issue arose that requires manual intervention to resolve). A series of plots are created (and saved) as the configuration generation progresses together with the \textbf{muffin} model configuration files themselves. All the various steps plus details of how the contents of the configuration files are generated are reported at the command line, and saved in a n ASCII format \texttt{*.log} file for future reference.

Depending on the specific configuration file settings (see later), \textbf{muffingen} has 5 main modes of operation, which are summarized as follows (and described in more detail, along with specific examples, below):

\begin{enumerate}[noitemsep]
\setlength{\itemindent}{.2in}
\setcounter{enumi}{0}
\vspace{1mm}
\item \textbf{Configuration derivation based on re-gridding climate output from a GCM.}
\\ The most common usage of \textbf{muffingen}, and enabling a new (typically paleo) configuration to be derived from the output of a GCM experiment. Currently options for utilizing 4 different GCMs are provided: HadCM3(l) (\texttt{'hadcm3'} or \texttt{'hadcm3l'}), FOAM (\texttt{'foam'}), CESM (\texttt{'cesm'}), and ROCKEE-3D (\texttt{'rockee'}).
\vspace{1mm}
\item \textbf{Derivation based on re-gridding a high resolution input topography.}
\\ In this option -- \texttt{'mat'} -- a land-sea mask and ocean bathymetry are re-gridded from a high(er) resolution \textsf{\footnotesize .mat} (\textbf{MATLAB}) topography file. Zonal wind-stress and speed, and zonal planetary albedo, are prescribed.
\vspace{1mm}
\item \textbf{Derivation based on an existing model topography '\texttt{.k1}' file (or simplified \texttt{.k2}) format variant).}
\\ This option -- \texttt{'k1'} or \texttt{'k2'} -- allows a topography to be re-created, or adapted/altered, all directly from an existing model 'k1' file (and hence existing model configuration). Zonal wind-stress and speed, and zonal planetary albedo, are prescribed.
\vspace{1mm}
\item \textbf{Derivation based on a prescribed land-sea mask.}
\\ This option -- \texttt{'mask'} -- will create a new configuration from any specified land-sea mask, whether 'real' or completely hypothetical. Zonal wind-stress and speed, and zonal planetary albedo, are prescribed.
\vspace{1mm}
\item \textbf{From a blank (all ocean) initial template.}
\\ Finally, this option -- \texttt{''} -- enables a topography to be drawn by hand within \textbf{muffingen} and hence represents an interactive alternative to (4) (rather than editing a land-sea mask in a text editor). Zonal wind-stress and speed, and zonal planetary albedo, are prescribed.
\end{enumerate}

\vspace{2mm}
Also depending on the specific options, and particularly whether or not \texttt{opt\_user} is set to \texttt{true}, an editor window will open, firstly for changes to the land-sea mask to be made, then later for the ocean bathymetry to be edited. Finally, a window will open allowing 'island paths' to be edited. The latter may be needed if \textbf{muffingen} cannot unambiguously determine them unaided.

Once you have successfully run \textbf{muffingen}, copy/transfer the entire  configuration subdirectory (the directory with the same name as whatever you called your 'world')  and its contents, from the \textbf{muffingen} output directory (e.g. \textsf{\small muffingen/OUTPUT.EXAMPLES}) on your local computer, to: \textsf{\footnotesize cgenie.muffin/genie-paleo}.

%------------------------------------------------

\newpage

\section{Configuring muffingen -- overview}

%------------------------------------------------

When \textbf{muffingen} is run, a configuration file with a specified filename\footnote{i.e. the single parameter passed to \textbf{muffingen} when it is invoked at the command line.} is loaded. The configuration file has a simple plain text (ASCII) format, but is given a \textsf{.m} extension, enabling the values of a number of controlling parameter values to be set directly in \textbf{MATLAB}.\footnote{Note that the parameter filename is passed as a string without the .m extension (which is implicitly assumed). An error message will be generated if the file does not exist or has the incorrect extension.} The configuration file parameters control facets of \textbf{muffingen} behavior such as the primary mode of operation, input and output filenames, what types of configuration files you want to generate, as well as there being a number of parameters controlling the finer details of re-gridding and configuration file generation, including whether to enable user-input or not.

The configuration files can be edited with the \textbf{MATLAB} editor (indeed, as a \textsf{\small .m} file, they are inherently a \textbf{MATLAB} format file and associated with this program), or any  text editor\footnote{But make sure they retain a \textsf{\small .m} rather than \textsf{\small .txt} filename extension}. The configuration file is divided up into a series of sections of different parameter options. The main (most commonly used) parameters are summarized as follows (and are more fully described later):

\begin{itemize}

\vspace{2mm}
\item []
\small\vspace{-2pt}\begin{verbatim}
% *** CONFIG NAME AND MAIN INPUT SETTINGS *******************************
\end{verbatim}\vspace{-2pt}\normalsize

\begin{itemize}[noitemsep]

\vspace{1mm}
\item [] \texttt{par\_wor\_name}
\vspace{1mm}
\\Defines the name of the model configuration. This must be a string, \uline{8 characters long}.
\\e.g. \texttt{par\_wor\_name='my\_world'}

\vspace{1mm}
\item [] \texttt{par\_gcm}
\vspace{1mm}
\\Defines the format of the input. The string is blank for an interactive user-defined world, i.e. \texttt{par\_gcm=''}

\vspace{1mm}
\item [] \texttt{par\_expid}
\vspace{1mm}
\\Defines the name of the GCM experiment if a GCM input is selected, or the '\textsf{\small .k1}' or '\textsf{\small .dat}' files if those respective input formats are selected by the above option.\footnote{By default, these files live in the \textsf{\small INPUT.EXAMPLES} sub-directory.}

\end{itemize}

\vspace{2mm}
\item []
\small\vspace{-2pt}\begin{verbatim}
% *** FILE PATHS ********************************************************
\end{verbatim}\vspace{-2pt}\normalsize

\vspace{2mm}
\item []
\small\vspace{-2pt}\begin{verbatim}
% *** GCM netCDF FILENAMES **********************************************
\end{verbatim}\vspace{-2pt}\normalsize

\vspace{2mm}
\item []
\small\vspace{-2pt}\begin{verbatim}
% *** GRID RESOLUTION ***************************************************
\end{verbatim}\vspace{-2pt}\normalsize

\begin{itemize}[noitemsep]

\vspace{1mm}
\item \texttt{par\_max\_i}
\vspace{1mm}
\\Defines the number of grid points in the longitude ('i') direction.
\\This is typically 36 or 18, e.g. \texttt{par\_max\_i=36}

\vspace{1mm}
\item \texttt{par\_max\_i}
\vspace{1mm}
\\Defines the number of grid points in the latitude ('j') direction.
\\This is typically 36 or 18 and is typically the same number as for the i direction, e.g. \texttt{par\_max\_j=36}

\vspace{1mm}
\item \texttt{par\_max\_k}
\vspace{1mm}
\\Defines the number of  layers in the ocean circulation model.
\\This is almost always either 16 or 8, e.g. \texttt{par\_max\_k=16}

\vspace{1mm}
\item \texttt{opt\_equalarea} [default: \texttt{true}]
\vspace{1mm}
\\This specifies whether or not an equal area grid is used/assumed. (A value of \texttt{false} results in the latitude grid being defined in equal increments of latitude).

\end{itemize}

\pagebreak

\vspace{2mm}
\item []
\small\vspace{-2pt}\begin{verbatim}
% *** REGRIDDING SETTINGS ***********************************************
\end{verbatim}\vspace{-2pt}\normalsize

\begin{itemize}[noitemsep]

\vspace{1mm}
\item [] \texttt{par\_max\_D} [default: \texttt{5000.0}]
\vspace{1mm}
\\Sets the maximum ocean (scale) depth (in m).
\\ See subsequent sub-sub-section on 'Ocean depth (and maximum levels)' for further details and usage.

\vspace{1mm}
For the sediment model re-gridding (you can ignore this is you are not using the \textbf{SEDGEM} module and wanting to simulate marine sediments, and have \texttt{par\_sedsopt=2} selected), there is:
\vspace{1mm}
\item [] \texttt{par\_sed\_Dmin} [default: \texttt{1000.0}]
\\\texttt{par\_sed\_Dmax} [default: \texttt{5000.0}]
\vspace{1mm}
\\which together set the minimum and maximum depths used in generating a random seafloor topography for \textbf{SEDGEM}.\footnote{Note that while \(5000m\) corresponds to the default deepest depth of the ocean circulation model, about \(15\%\) of the modern seafloor lies below this (and mostly shallower than \(6000m\)). So selecting \texttt{6000.0} would arguably enable a better simulation of e.g. the CCD.}

\end{itemize}

\vspace{2mm}
\item []
\small\vspace{-2pt}\begin{verbatim}
% *** OPTIONS -- MAIN ***************************************************
\end{verbatim}\vspace{-2pt}\normalsize

\begin{itemize}[noitemsep]

\vspace{1mm}
\item [] \texttt{opt\_user} [default: \texttt{true}]
\vspace{1mm}
\\Determines whether \textbf{muffingen} pauses and allows user-modification of land-sea mask and ocean depth (and island paths).

\vspace{1mm}
\item [] \texttt{opt\_plots} [default: \texttt{false}]
\vspace{1mm}
\\Determines whether or not to plot all input and re-gridded boundary conditions.\footnote{For GCM-based re-gridded, this can sometimes take some time to do.}

\end{itemize}

\end{itemize}

%------------------------------------------------

\subsection{muffingen configuration examples}

A series of example configurations are provided in the main \textbf{muffingen} directory. These illustrate parameter settings and the primary ways of using \textbf{muffingen}. They also serve as useful template parameter setting files.  They are:

\vspace{1mm}
\begin{itemize}[noitemsep]

\vspace{1mm}
\item \textsf{\footnotesize EXAMPLE\_BLANK} -- Starts from a blank ('water-world'), all-ocean (no land) template. User input (allowing continents and seafloor topography to be 'drawn') is automatically activated whether you want it or not!\footnote{Because it assumes that you are going to go on and draw something ...}\(^{,}\)\footnote{Edit the \textbf{muffingen} code to be able to turn off.}

\vspace{1mm}
\item \textsf{\footnotesize EXAMPLE\_BLANK\_deep} -- As above, except with a slightly deeper ocean -- 18 levels with the first 16 spanning 5000.0 m.\footnote{Refer to subsequence explanation re. the details of these parameters.} (Simply provided as an example of creating model grids with more depth levels and a deeper maximum depth.)

\vspace{1mm}
\item \textsf{\footnotesize EXAMPLE\_MASK\_drakeworld} -- The first of a series of 4 conceptual worlds (loosely following the literature). This starts from a land-sea mask (\footnotesize\textsf{wordrake.dat}\normalsize) which is stored in the \textbf{muffingen} subdirectory \footnotesize\textsf{INPUT.EXAMPLES}\normalsize. The land fraction is minimal (as it is trying to reproduce the sort of zero-area numerical barrier used in the literature). This configuration has a barrier to ocean circulation, from the N pole down, with a high southern latitude gateway (a Drake Passage like feature).

\vspace{1mm}
\item \textsf{\footnotesize EXAMPLE\_MASK\_eqpasworld} -- As above, except with an equatorial (only) gateway.

\vspace{1mm}
\item \textsf{\footnotesize EXAMPLE\_MASK\_ridgeworld} -- As above, except with no gateway.

\vspace{1mm}
\item \textsf{\footnotesize EXAMPLE\_MASK\_waterworld} -- As above, but with no barriers, i.e. a 'water world'.

\vspace{1mm}
\item \textsf{\footnotesize EXAMPLE\_GCMFOAM\_modern} -- Takes the continental configuration and climate simulation output from a fully coupled GCM experiment (files in directory \footnotesize\textsf{GCMFOAM }\normalsize in the \textbf{muffingen} subdirectory \footnotesize\textsf{INPUT.EXAMPLES }\normalsize) and derives full \textbf{muffin} model boundary conditions. User input (allowing continents and seafloor topography to be 'edited') is activated by default.

\vspace{1mm}
\item \textsf{\footnotesize EXAMPLE\_GCMHadCM3L\_modern} -- Similar to the above -- takes the continental configuration and climate simulation output from a fully coupled GCM experiment (files in directory \footnotesize\textsf{GCMHadCM3L }\normalsize in the \textbf{muffingen} subdirectory \footnotesize\textsf{INPUT.EXAMPLES }\normalsize) and derives full \textbf{muffin} model boundary conditions. User input (allowing continents and seafloor topography to be 'edited') is activated by default.

\vspace{1mm}
\item \textsf{\footnotesize EXAMPLE\_K1\_permian} -- Starts from a muffin model configuration 'k1' topography defining file: \textsf{\footnotesize p0251b.k1}, which is stored in the \textbf{muffingen} subdirectory \texttt{INPUT.EXAMPLES}. The k1 file defines a late Permian continental configuration (and bathymetry). User modification is enabled by default (so \textbf{MATLAB} pauses for modifications to be made), but this can be disabled (\texttt{opt\_user=false}).

\vspace{1mm}
\item \textsf{\footnotesize EXAMPLE\_K1\_SEDGEMonly} -- Similar to \textsf{\footnotesize EXAMPLE\_K1\_permian} -- starts from a muffin model configuration 'k1' topography defining file: \textsf{\footnotesize p0251b.k1}, but only generates the SEDGEM sediment model files (and nothing else).

\vspace{1mm}
\item \textsf{\footnotesize EXAMPLE\_K2\_supercontinent} -- Starts from a simplified version of the muffin model configuration 'k1' topography defining file -- here given  the extension 'k2'. This (\textsf{\footnotesize wppcont1.k2}) is stored in the \textbf{muffingen} subdirectory \texttt{INPUT.EXAMPLES}. The k2 file defines an idealized pole-to-pole super-continent. User modification is enabled by default (so \textbf{MATLAB} pauses for modifications to be made), but this can be disabled (\texttt{opt\_user=false}).

\vspace{1mm}
\item \textsf{\footnotesize EXAMPLE\_MAT\_present\_bathymetry} -- Takes as input a high resolution topography in a \textbf{MATLAB} \textsf{\footnotesize .mat} file format. In this specific example, the file (subdirectory \texttt{INPUT.EXAMPLES}) inputted is \textsf{\footnotesize present\_bathymetry} (\textsf{\footnotesize .mat}) which describes at \(1^{\circ}\) resolution, the modern plate configurations plus seafloor topography (as negative height).\footnote{The specific grid resolution is defined, and the file loaded and the grid orientation assumed, in the \texttt{LOAD GRID (AXES) DATA} and \texttt{LOAD TOPO \& MASK DATA} sections. Different resolutions and orientations (and file formats) can be dealt with here by editing the code.}
\\If you want anything other than a \(1^{\circ}\) resolution (or a different longitude origin) then you need to edit the code:
\small\begin{verbatim}
% NOTE: assume equal Dlon, Dlat grid (non equal area) and 1 degree
%       also that the input grid starts at -180E
% >>> EDIT ME >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
gi_lonce = [-180.0:1.0:180.0];
gi_latce = [-90.0:1.0:90.0];
% <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
\end{verbatim}\normalsize
Note that non-rectilinear grids are not supported here. If you have 3 poles in your grid ... too bad.

\end{itemize}
\vspace{2mm}

%------------------------------------------------

\newpage

\section{Pre-generated worlds}

A series of conceptual ('fake') worlds have been generated and are provided for you convenience :o) These fall into 2 categories:

\begin{enumerate}[noitemsep]
\vspace{1mm}
\item Conceptual worlds
\\These include 'water world', 'ridge world', 'drake world', etc. and associated variants, e.g. as published in fully coupled GCMs\footnote{Example of aquaplanets and drake worlds in the MITgcm with simplified atmosphere:
\\Rose, B. E. J., Ferreira, D. \& Marshall, J. The role of oceans and sea ice in abrupt transitions between multiple climate states. J. Clim. 26, 2862–2879 (2013).
\\Ferreira, D., Marshall, J. \& Rose, B. Climate determinism revisited: Multiple equilibria in a complex climate model. J. Clim. 24, 992–1012 (2011).}. They are designed to test controls on large-scale ocean circulation and do conform to an Earth-appropriate ocean volume or total cratonic area.
\vspace{1mm}
\item Idealized-continent worlds
\\These involve idealized super-continental configurations but aim to retain modern ocean volume and total cratonic area characteristics.
\end{enumerate}
\vspace{1mm}

Both \textsf{\footnotesize genie-paleo} configuration file sets (sub-directories), and example \textit{base-configs} are provided as part of the muffin code base. The details of these two series of fake worlds are as follows. Remember that the \textsf{\footnotesize .m} file configurations that create each of the fake world configurations are saved in the respective \textsf{\footnotesize genie-paleo} sub-directory, and hence both the specific details of how the world was created are available, as well as the ability to exactly recreate the world.

%------------------------------------------------
%
\subsection{Conceptual worlds}

\small\begin{itemize}[noitemsep]
\vspace{1mm}
\item \textsf{\footnotesize } [TO\ BE\ ADDED]
\end{itemize}\normalsize
\vspace{1mm}

%------------------------------------------------
%
\subsection{Idealized-continent worlds}

The idealized continents come both without (i.e. the configuration is either land, or deep ocean) or with, continental shelves, and in the latter case, come with varying number of 'steps' down to deeper water (and hence to the abyssal plain).

The fake world series 'k1' configuration names start with one of two, 4 character strings:
\begin{itemize}[noitemsep]
\vspace{1mm}
\item \textsf{\footnotesize fkh\_} == 'high' resolution (\(36\times36\times16\))
\item \textsf{\footnotesize fkl\_} == 'low' resolution (\(18\times18\times16\))
\end{itemize}
\vspace{1mm}
\noindent (No low vertical resolution, e.g. \(8\) level version is currently provided.)
\vspace{1mm}

The next 2 characters delineate the shape/position of the world:
\begin{itemize}[noitemsep]
\vspace{1mm}
\item \textsf{\footnotesize 1e} == a single Equatorial-centered super-continent
\item \textsf{\footnotesize np} == a singleNorth polar-centered super-continent
\item \textsf{\footnotesize pp} == a pole-to-pole super-continent
\end{itemize}
\vspace{2mm}

The 7th character is the 'series' represents:
\begin{itemize}[noitemsep]
\vspace{1mm}
\item \textsf{\footnotesize 0} == An earlier generation of worlds, with shelves stepping down in increments of only \(1\) ocean level.
\\Note that in generating the wind-stress in this series, the presence/absence of high latitude gateways is automatically identified (meaning that the zonal wind-stress profiles differ between \textsf{\footnotesize np} and \textsf{\footnotesize pp} in the magnitude of wind-stress in the Southern Hemisphere) -- \texttt{par\_tauopt=0}.
\vspace{1mm}
\item \textsf{\footnotesize 1} == A subsequent generation, with shelves stepping down in increments of 2 ocean levels.
\\Note: An intermediate wind-stress magnitude is applied to both hemispheres in all configurations (i.e. no distinction is made between hemisphere with or without high latitude gateways) -- \texttt{par\_tauopt=3} .
\vspace{1mm}
\item \textsf{\footnotesize 2} == A modification of \#1,  generated with a newer version of \textbf{muffingen}, and with an imposed limit of \(1000-5000 m\) for the range of \textbf{SEDGEM} open ocean depths (the previous version included   depths extending to the shallow sub-surface).
\\Note that \texttt{par\_tauopt=0} is used. 
\\Also note that in \textsf{\footnotesize pp}, shelves are only created on the Eastern margin of the basin so as to retain consistency in total shelf area with  \textsf{\footnotesize np}.
\end{itemize}
\vspace{2mm}

The 8th character (digit) specifies the number of shelves, which for the initial series is:

\vspace{1mm}
\small\begin{enumerate}[noitemsep]
\setlength{\itemindent}{.2in}
\setcounter{enumi}{-1}
\item (none)
\item level \(15\)
\item level \(15 + 14\)
\item level \(15 + 14 + 13\)
\item level \(15 + 14 + 13 + 12\)
\item level \(15 + 14 + 13 + 12 + 11\)
\end{enumerate}\normalsize
\vspace{1mm}
and for the newer series:
\small\begin{enumerate}[noitemsep]
\setlength{\itemindent}{.2in}
\setcounter{enumi}{-1}
\item (none)
\item level \(15\)
\item level \(15 + 13\)
\item level \(15 + 13 + 11\)
\item level \(15 + 13 + 11 + 9\)
\end{enumerate}\normalsize
\vspace{1mm}

All the oceans are ca. \(3500 m\) deep, i.e. truncated at ocean level \(3\), in order to produce approximately the present-day ocean volume.\footnote{To change this, simply search-and-replace the \texttt{3} in the \textsf{\footnotesize .k1} file with e.g. \texttt{1}.}

Example \textit{base-configs} are provide for some, but not all of the idealized worlds, and follow the same naming convention and have full filenames of the form: \textsf{\footnotesize muffin.CB.\(\ast\ast\ast\ast\ast\ast\ast\ast\).BASES.config}, where \(\ast\ast\ast\ast\ast\ast\ast\ast\) is the 8-character fake world 'k1' configuration name (see above). A basic set of tracers is provided (\textsf{\footnotesize BASES}).

Other than the rate at which the shelves step down\footnote{(and that the earlier generation was for a pole-to-pole super-continent only)}, the main difference between the different generations of worlds, is in the applied zonal wind field strength. In the earlier fake world series, the 'zonal wind-stress generation option' (\texttt{par\_tauopt}) was \texttt{0}. This attempts to automatically determine the presence of high latitude ocean gateways and if they exist, apply a stronger zonal wind field in that hemisphere (otherwise, a wind stress appropriate for a modern northern-hemisphere configuration with no zonal gateway is applied). To reduce the number of boundary conditions that change and co-vary between different fake worlds, in the second generation of idealized continent worlds, an intermediate strength zonal wind field is applied to all, regardless of the presence of absence of high latitude circumpolar ocean gateways. This is  'zonal wind-stress generation option' \texttt{3}. Note that for the same resolution, wind-fields can be substituted/replaced, and using the saved \textsf{\footnotesize .m} configuration file, worlds can be re-generated with different wind-stress options if desired. The depth range of the ocean floor in\ \textbf{SEDGEM} (which informs the pressure used in the \(CaCO_{3}\) stability calculation) is slightly restricted in \#3 (the upper limit increased to \(1000 m\)).

%------------------------------------------------
%
\subsection{Modern worlds}

To both help illustrate how the configuration files are organized and accessed for paleo worlds, and to help make modifying older (modern) configurations easier, the 2 basic (published) modern configurations are provided in a 'genie-paleo' format (i.e. the format generated by \textbf{muffingen}):
\begin{itemize}[noitemsep]
\vspace{1mm}
\item \textsf{\footnotesize p\_worbe2} == The 8-level \(36\times36\) ocean configuration of \textit{Ridgwell et al.} [2007] and including the geological carbon cycle (\textbf{SEDGEM}+\textbf{ROKGEM}) configuration files of \textit{Ridgwell and Hargreaves} [2007] (also: \textit{Lord et al.} [2015]).
\vspace{1mm}
\item \textsf{\footnotesize p\_worjh2} ==  The 16-level \(36\times36\) ocean configuration of \textit{Cao et al.} [2009] and including the geological carbon cycle (\textbf{SEDGEM}+\textbf{ROKGEM}) configuration files of \textit{Archer et al.} [2009] (also: \textit{Winkelmann et al.} [2015]).
\end{itemize}

\vspace{2mm}
\noindent Corresponding example \textit{base-} and \textit{user-config} files are provided:
\begin{itemize}[noitemsep]
\vspace{1mm}
\item \textsf{\footnotesize muffin.CBSR.p\_worbe2.BASES.config} plus: \textsf{\footnotesize muffin.CBSR.p\_worbe2.BASES.SPIN1} \\(in: \textsf{\footnotesize genie-userconfig/EXAMPLES}), which runs the first-stage spin-up described in \textit{Ridgwell and Hargreaves} [2007] (and also used in \textit{Lord et al.} [2015]).
\vspace{1mm}
\item \textsf{\footnotesize muffin.CBSR.p\_worjh2.BASES.config} plus: \textsf{\footnotesize muffin.CBSR.p\_worjh2.BASES.SPIN1} \\(in: \textsf{\footnotesize genie-userconfig/EXAMPLES}), which runs the first-stage spin-up used in \textit{Archer et al.} [2009] and \textit{Winkelmann et al.} [2015].
\end{itemize}

as well as some reduced tracer and biogeochemical complexity variants, such as \textsf{\footnotesize muffin.CB ...} and \textsf{\footnotesize muffin.C ...}

\vspace{2mm}
\noindent To make modified (e.g. wind fields) versions of either of the 2 modern 'paleo' format configurations:
\begin{enumerate}[noitemsep]
\vspace{1mm}
\item Copy and rename the  (8- or 16-level ocean configuration) \textsf{\footnotesize genie-paleo} sub-directory, giving it an \uline{8 (or 6) character string name}.
\vspace{1mm}
\item In this new sub-directory, edit the files (wind stress, wind velocity, wind speed, albedo, and/or topography) you want to modify. (These files do not need to be renamed.)
\vspace{1mm}
\item Copy and rename the corresponding \textit{base-config} file (disabling the parameter settings for \textbf{SEDGEM} and \textbf{ROCKGEM}, and/or enabling \textbf{ECOGEM}, as required).
\\Then, in the \textit{base-config} file, edit all instances of the \textsf{\footnotesize genie-paleo} subdirectory parameters  to match the new \textsf{\footnotesize genie-paleo} sub-directory you assigned in step (1). (Parameters, e.g.: \textsf{\footnotesize ea\_1='../../cgenie.muffin/genie-paleo/p\_worbe2'}.
\vspace{1mm}
\item Copy-rename the example \textit{user-config}, or modify your own existing one.
\\Note that when employing the geological carbon cycle, the resolution of the sediment (and weathering) grids and associated boundary condition files are now defined in the \textit{base-config} rather than the \textit{user-config} (as originally done).
\end{enumerate}

%------------------------------------------------
%
%
%------------------------------------------------

\newpage

\section{Configuring muffin experiments}\label{sec:configuring_muffin_experiments}

%------------------------------------------------

Having created a new \textbf{muffin} configuration using the \textbf{MATLAB} function \textsf{\footnotesize muffingen.m}, you are now going to need to create the 2 key model and experiment configuration files before you can actually run anything\footnote{Note that steps 1c, 1d, and 2 are not independent of each other and need to be consistent -- e.g. if you define Fe co-limitation of biological productivity in step 2, you need to have selected the appropriate tracers in step 1c. And if you specify biological productivity calculated by \textbf{ECOGEM} in step 2, you need to have selected the \textbf{ECOGEM} module in step 1d.}:

\begin{enumerate}[noitemsep]
\vspace{1mm}
\item You need to create a \textit{base-config}, which includes the parameter settings of your new world.
\\There will there be 4 steps involved in this:
\begin{enumerate}[noitemsep]
\item Choosing a template \textit{base-config} file, which specifies appropriate physics parameters.
\item Copy-pasting a list of parameter settings that has been automatically-generated by \textbf{muffingen} into the template\textit{ base-config} file.
\item Defining the number of dissolved and particulate tracers in the ocean (and gases in the atmosphere) that you want and entering this into the \textit{base-config}.
\item Ensure that the appropriate science modules are enabled in the \textit{base-config}.
\end{enumerate}
\vspace{1mm}
\item You need to create a \textit{user-config}, whether simply to test the configuration or to provide the basis of a series of experiments.
\end{enumerate}
\vspace{1mm}

Templates are provided and more detailed instructions follow. However, note that if you have similar \textit{base-config} and \textit{user-config} files already, then you can simply adapt these. Another option is to utilize \textit{base-config} and \textit{user-config} files associated with any of the published experiments listed in \textsf{\footnotesize genie-userconfigs/MS}, or any of the described \textsf{\footnotesize EXAMPLE.*} example configurations.

\vspace{1mm}
And then finally ...
\begin{enumerate}[noitemsep]
\vspace{1mm}
\setcounter{enumi}{2}
\item You will need to ensure that all file are in their correct location in the \textbf{muffin} directory structure.
\end{enumerate}
\vspace{1mm}

%------------------------------------------------
%
\noindent\rule{4cm}{0.5pt}
\subsubsection{1a. Choosing a template \textit{base-config}}

If you do not want to adapt an existing \textit{base-config} (see suggestions above) or want to start 'fresh', a pair of alterative template files are provided with \textbf{muffingen} (copy and rename the file, and then edit). The template files are missing the definitions of the world settings and tracers, which will be rectified in steps 1b and 1c, respectively. They also only specify a basic set of science modules (addressed in step 1d). Otherwise, they differ only in the tunable physics parameter values, under the heading:

\footnotesize\vspace{-2pt}\begin{verbatim}
# *******************************************************************
# PHYSICAL CLIMATE CALIBRATION
# *******************************************************************
\end{verbatim}\vspace{-2pt}\normalsize

The available template files are:

\begin{itemize}[noitemsep]

\vspace{2mm}
\item \textsf{\small BASECONFIG.08lvl.config}
\vspace{1mm}
\\This is based on the physics calibration as used in e.g. \textit{Ridgwell et al.} [2007] and \textit{Ridgwell and Hargreaves} [2007] with the parameters tuned for an 8-level ocean modern world (specifically: \texttt{worbe2}). For fake and paleo worlds with an 8-level ocean, this is the recommended template.\footnote{If you want \uline{exactly} the same physics as per e.g. \textit{Ridgwell et al.} [2007];  \textit{Ridgwell and Hargreaves} [2007] , use: \linebreak\textsf{\footnotesize cgenie.eb\_go\_gs\_ac\_bg.worbe2.BASES.config} as a template.}

\pagebreak

The differences compared to the published usages are:
\begin{itemize}[noitemsep]
\vspace{1mm}
\item The ocean starts warmer (\(5^{\circ}C\))\footnote{These parameters could potentially be increased further (to say ...  \(10^{\circ}C\)).} than the default (\(0^{\circ}C\)). This helps the ocean circulation come to an equilibrium state more rapidly, particularly for greenhouse climates:
\small\vspace{-2pt}\begin{verbatim}
# temp0 -- start with a warm ocean
go_10=5.0
# temp1 -- start with a warm ocean
go_11=5.0
\end{verbatim}\vspace{-2pt}\normalsize
Note that both parameters should be changed together (one sets the Northern Hemisphere temperature, and one the Southern ... or something ...).
\vspace{1mm}
\item There is no (salt / freshwater) flux adjustment, with the scaling parameter set to zero:
\small\vspace{-2pt}\begin{verbatim}
# SclFWF -- scale for zero freshwater re-balancing
ea_28=0.0
\end{verbatim}\vspace{-2pt}\normalsize
Note that the built-in (salt / freshwater) flux adjustment is designed to maintain a strong AMOC and the code is specific to the original modern continental configurations (e.g. \texttt{worbe2}, \texttt{worjh2}). A (salt / freshwater) flux adjustment using this parameter and associated code should never be used for paleo or fake worlds.\footnote{Instead, a salt forcing in the desired deep-water formation location, balanced by a freshwater flux elsewhere, can be defined.}
\vspace{1mm}
\item The sea-ice diffusivity parameters are adjusted for improved stability\footnote{The original parameter setting was:
\\gs\_11=6200.000}:
\small\vspace{-2pt}\begin{verbatim}
# reduced sea-ice eddy diffusivity
gs_11=1000.000
# set a fractional sea-ce coverage threshold for preventing advection
gs_par_sica_thresh=0.99
\end{verbatim}\vspace{-2pt}\normalsize
\vspace{1mm}
\item Insolation forcing is seasonal\footnote{The original tuned 8-level ocean circulation model configuration had no seasonal cycle (options set to \texttt{.false.}).}:
\small\vspace{-2pt}\begin{verbatim}
# set seasonal cycle
ea_dosc=.true.
go_dosc=.true.
gs_dosc=.true.
\end{verbatim}\vspace{-2pt}\normalsize
Note that all the respective parameter for all three physical climate components (ocean circulation model, sea-ice model, EMBM atmosphere) needs to be set.
\vspace{1mm}
\item An additional option is provided for toggling between isopycnal/diapycnal (\texttt{.true.}) and horizontal/vertical (\texttt{.false.}) mixing schemes:
\small\vspace{-2pt}\begin{verbatim}
# it is recommended that it is turned OFF (=.false.) for 'fake' worlds
go_diso=.true.
\end{verbatim}\vspace{-2pt}\normalsize
In all modern and 'realistic' paleo configurations, isopycnal/diapycnal mixing is used. However, this scheme can lead to unwanted negative tracer values. In extreme biogeochemical configurations, particularly at low atmospheric \(pO_{2}\) and when sharp horizontal transitions in redox state in the ocean occur, the magnitude of negative values can become unacceptable.
\\Work with fake worlds, where no ocean like that may have ever existed on Earth and hence there is no specific ocean circulation pattern to try and reproduce, the recommendation is to use the horizontal/vertical (\texttt{.false.}) mixing scheme.
\end{itemize}
\vspace{1mm}

\vspace{1mm}
\item \textsf{\small BASECONFIG.16lvl.config}
\vspace{1mm}
\\This is based on the physics calibration as used in e.g. \textit{Cao et al.} [2009] with the parameters tuned for a 16-level ocean modern world (specifically: \texttt{worjh2}). For fake and paleo worlds with an 16-level ocean, this is the recommended template.\footnote{If you want \uline{exactly} the same physics as per e.g. \textit{Cao et al.} [2009], use: \\\textsf{\footnotesize cgenie.eb\_go\_gs\_ac\_bg.worjh2.BASES.config} as a template.} This includes the same changes as per made for the 8-level ocean circulation model based configuration:
\begin{itemize}[noitemsep]
\vspace{1mm}
\item The ocean starts warmer (\(5^{\circ}C\)).
\vspace{1mm}
\item There is no (salt / freshwater) flux adjustment.
\vspace{1mm}
\item The sea-ice diffusivity parameters are adjusted for improved stability\footnote{The original parameter setting was:
\\gs\_11=3573.718}.
\end{itemize}
\vspace{1mm}

\begin{itemize}[noitemsep]
\vspace{1mm}
\item
Again as per for the 8-level ocean template \textit{base-config}, an option is highlighted for toggling between isopycnal/diapycnal (\texttt{.true.}) and horizontal/vertical (\texttt{.false.}) mixing schemes:
\small\vspace{-2pt}\begin{verbatim}
# it is recommended that it is turned OFF (=.false.) for 'fake' worlds
go_diso=.true.
\end{verbatim}\vspace{-2pt}\normalsize
As per for the 8-level ocean configuration, it is recommended to implement simple horizontal/vertical (\texttt{.false.}) mixing.
\end{itemize}

\vspace{1mm}
Finally, it should be noted that compared to the \textit{Cao et al.} [2009] configuration, there is no modification of atmospheric diffusivity over the Southern Ocean and Antarctica, which was added to improve the seasonal sea-ice properties in the Southern Ocean in the \texttt{worjh2} modern configuration.\footnote{The parameters for this were:
\\\texttt{\# diffusivity scaling factor}
\\\texttt{ea\_diffa\_scl=0.25}
\\\texttt{\# grid point distance over which scalar is applied (j direction)}
\\\texttt{ea\_diffa\_len=3}
\\but by default, reduced atmospheric diffusivity is disabled.}

\end{itemize}
\vspace{1mm}

%------------------------------------------------
%
\noindent\rule{4cm}{0.5pt}
\subsubsection{1b. Defining your 'world' in the \textit{base-config}}

Having chosen a \textit{base-config} file to work with, you are now going to copy-paste in the block of parameters that defines the \textbf{muffingen}-generated world.

\vspace{2mm}
In the template \textit{base-config} there is a highlighted (\(<<<\;\;\;\;\;>>>\)) line in the  file:
\footnotesize\vspace{-2pt}\begin{verbatim}
# *******************************************************************
# GRID & BOUNDARY CONDITION CONFIGURATION
# *******************************************************************
# insert the automatically generated muffingen parameter list here
# *******************************************************************
# <<<                                                             >>>
# *******************************************************************
\end{verbatim}\vspace{-2pt}\normalsize

Copy and paste the contents of the \textbf{muffingen} output file\footnote{In the filename, \texttt{yymmdd} is the date of the configuration creation.}: \textsf{\footnotesize config\_yymmdd.txt}
into the template file where indicated -- immediately above, immediately below, or simply replacing the entire \(<<<\;\;\;\;\;>>>\) line.

%------------------------------------------------
\newpage 
%------------------------------------------------
%
\subsubsection{1c. Defining tracers in the \textit{base-config}}

As per for defining the specific world, there is an explicit section of the template \textit{base-config} that needs to be edited:

\footnotesize\vspace{-2pt}\begin{verbatim}
# *******************************************************************
# TRACER CONFIGURATION
# *******************************************************************
# the total number of tracers includes T and S
# T and S do not need to be explicited selected and initialzied
# *******************************************************************
# Set number of tracers
GOLDSTEINNTRACSOPTS='$(DEFINE)GOLDSTEINNTRACS=2'
# list selected biogeochemical tracers
# <<<                                                             >>>
# list biogeochemical tracer initial values
# <<<                                                             >>>
# *******************************************************************
\end{verbatim}\vspace{-2pt}\normalsize

The template \textit{base-config} files come with just 2 ocean tracers defined -- temperature and salinity (i.e., there is no carbon cycle or ocean nutrients \textit{etc.} enabled at this point). These are implicit and essential to ocean circulation and hence are not  listed. However, the count of total number of tracers in the ocean (which determines the compiled tracer and tracer-related array size) includes them, i.e.

\footnotesize\vspace{-2pt}\begin{verbatim}
# Set number of tracers
GOLDSTEINNTRACSOPTS='$(DEFINE)GOLDSTEINNTRACS=2'
\end{verbatim}\vspace{-2pt}\normalsize

So how to fill out the list of tracers? A complete list of all gaseous (in the atmosphere), dissolved (ocean only), and particulate (ocean and also sediments) tracers can be found in the files: \textsf{\footnotesize tracer\_define.atm}, \textsf{\footnotesize tracer\_define.ocn}, and \textsf{\footnotesize tracer\_define.sed}, respectively (in directory \textsf{\footnotesize genie-main/data/input}). However, starting from scratch and knowing which ones to add to create a consistent and sufficient set is not trivial. Instead, and as before, you could take a published configuration from one of the \textsf{\footnotesize genie-useroncigs/MS} subdirectories (refer to the \textit{base-config} employed in the README file) or an EXAMPLE.

Either copy-paste the entire \texttt{\# TRACER\ CONFIGURATION} section, or individually update the three subsections (or copy-paste the entire block, then edit):

\begin{enumerate}[noitemsep]
\vspace{1mm}
\item \texttt{\# list selected biogeochemical tracers}
\\First list (set equal to \texttt{.true.} all the gaseous (in the atmosphere), dissolved (ocean only), and particulate (ocean and also sediments) tracers.
\vspace{1mm}
\item \texttt{\# Set number of tracers}
\\Count up how many ocean tracers there are, and add \(2\) for temperature and salinity (which you do not need to explicitly list), and update (the value of \texttt{2}) in the line:
\footnotesize\begin{verbatim}
GOLDSTEINNTRACSOPTS='$(DEFINE)GOLDSTEINNTRACS=2'
\end{verbatim}\normalsize
\vspace{1mm}
\item \texttt{\# list biogeochemical tracer initial values}
\\Then, if you wish for any of the gaseous and dissolved (there is no initialization option for particulate/solid tracers) not to be initialized at zero, list their initial values.
\\Units of gas partial pressure are \(atmospheres \;(atm)\). Units of dissolved tracers in the ocean are \(mol\:kg^{-1}\).
\\Note that if you employ a \textit{re-start}, then these values are over-written.
\end{enumerate}
\vspace{1mm}

%------------------------------------------------
\newpage 
%------------------------------------------------

A series of template tracer lists, taken from published configurations, are also provided:

\begin{itemize}[noitemsep]

\vspace{1mm}
\item \textsf{\small TRACERCONFIG.ABIOTIC.txt}
\vspace{1mm}
\\This is rather trivially ... the same as in the \textit{base-config} templates and defines an ocean (and atmosphere) with no biogeochemical tracers, just T and S in the ocean.
\\You might use this if you were only interested in questions of ocean circulation and climate, although even then, you might want to add an age tracer to the ocean (see HOW-TO on diagnosing how the model works) which you would do by un-commenting the line that defines 3 total tracers (and comment the line defining just 2), and un-comment the line setting: \textsf{\footnotesize gm\_ocn\_select\_48=.true.}

\vspace{2mm}
\item \textsf{\small TRACERCONFIG.Ridgwelletal.2007.txt}
\vspace{1mm}
\\This is the set of tracers used in \textit{Ridgwell et al.} [2007] and defines a \(PO_{4}\)-based biological pump, with \(^{13}C\) in all the carbon pools, and the capability for accounting for sulphate-reduction with dissolved \(O_{2}\) is depleted.
\\This is one of the simplest but most versatile tracer sets, particularly for paleo, when simulating \(^{13}C\) may be important. It is usable with any \(PO_{4}\)-only based biological scheme, including \textbf{ECOGEM} with \(Fe\) cell quotas disabled (\textit{Wilson et al.} [2018]). Other publications include:
\vspace{1mm}
\begin{itemize}[noitemsep]
\item \textit{Ridgwell and Schmidt} [2010]
\item \textit{Ridgwell and Hargreaves} [2007]
\item \textit{Crichton et al.} [2020]
\end{itemize}

\vspace{2mm}
\item \textsf{\small TRACERCONFIG.Caoetal.2009.txt}
\vspace{1mm}
\\This is the set of tracers used in \textit{Cao et al.} [2009] and defines a \(PO_{4}\)-based biological pump, with \(^{13}C\) in all the carbon pools. \\Unlike \textsf{\footnotesize TRACERCONFIG.Ridgwelletal.2007.txt}, there are no \(SO_{4}\) or \(H_{2}S\) tracers defined in the ocean and hence no potential for sulphate-reduction. Excess oxygen consumption then results in the creation and transport (and subsequent destruction) of negative concentrations of \(O_{2}\). Kinetically (and in terms of large-scale patterns of oxygenation), this is very similar to creating and then re-oxidizing hydrogen sulphide -- see \textit{Meyer et al.} [2016].
\\This set of tracers also includes radiocarbon \(^{14}C\) in all the carbon pools, for diagnosing ocean circulation (and water mass ages). Additionally, both \(CFC-11\) and \(CFC-12\) are included for tracing deep-water formation. See \textit{Cao et al.} [2009] for how these tracers are used.

\vspace{2mm}
\item \textsf{\small TRACERCONFIG.Odalenetal.2019.txt}
\vspace{1mm}
\\This is the set of tracers used in \textit{Odalen et al.} [2019] and defines a biological pump with both \(PO_{4}\) and \(Fe\) co-limitation. There are no \(SO_{4}\) or \(H_{2}S\) tracers defined in the ocean and hence no potential for sulphate-reduction, but \(^{13}C\) is included in all the carbon pools.
\\This set of tracers includes a variety of numerical/color tracers for diagnosing pre-formed properties \footnote{See: 'diagnose how the model works' HOW-TO} -- here of \(DIC\), \(ALK\), \(O_{2}\), \(PO_{4}\), and \(\delta^{13}C\).
\\The iron cycle is the original configuration, where 3 separate tracers are included: \(Fe\) (free dissolved iron), \(L\) (free ligands), and \(FeL\) (iron bound to ligands). Because the equilibrium between these tracers is re-solved every time-step (and used to determine the \(Fe\) concentration for scavenging), there is redundancy, and in practice, only 2 tracers are needed. Subsequent iron cycle scheme hence use only 2 tracers (e.g. see: \textsf{\footnotesize TRACERCONFIG.Wardetal.2018.txt}). The 3-tracer scheme was also used in \textit{Tagliabue et al.} [2016].

\vspace{2mm}
\item \textsf{\small TRACERCONFIG.Wardetal.2018.txt}
\vspace{1mm}
\\This is the set of tracers used in \textit{Ward et al.} [2018] and defines a biological pump with both \(PO_{4}\) and \(Fe\) co-limitation of biological productivity (in \textbf{ECOGEM}). \(SO_{4}\) or \(H_{2}S\) tracers as well as \(^{13}C\) are included. There are no circulation diagnostic and/or numerical/color tracers.
\\The configuration of the marine iron cycle differs from that of \textit{Odalen et al.} [2019] and \textit{Tagliabue et al.} [2016] in that only two tracers are now explicitly represented and transported in the ocean -- \(TDFe\) (total dissolved iron, including iron bound to ligands) and \(TL\) -- total dissolved ligand concentration (both free and bound to iron). At each time-step, the concentration of 'free' iron (and iron bound to ligands) is solved for and used to calculate iron removal though scavenging.

\end{itemize}

%------------------------------------------------
%
\noindent\rule{4cm}{0.5pt}
\subsubsection{1d. Enabling science modules in the \textit{base-config}}

The final step in configuring your \textit{base-config} file, is to ensure that all the science modules you wish to include are included (and those you do not want, are not). The template \textit{base-config} files specify the basic/simply climate system combination of \textbf{GOLDSTEIN} ocean circulation model, \textbf{GOLDSTEIN} sea-ice model, and the \textbf{EMBM} atmospheric model. In addition, the atmospheric geochemistry module (\textbf{ATCHEM}) and the ocean biogeochemsitry module (\textbf{BIOGEM}) are selected. These settings look like:

\footnotesize\vspace{-2pt}\begin{verbatim}
# *******************************************************************
# GENIE COMPONENT SELECTION
# *******************************************************************
# make .TRUE. the cGENIE modules to be included
# *******************************************************************
ma_flag_ebatmos=.TRUE.
ma_flag_goldsteinocean=.TRUE.
ma_flag_goldsteinseaice=.TRUE.
ma_flag_biogem=.TRUE.
ma_flag_atchem=.TRUE.
ma_flag_sedgem=.FALSE.
ma_flag_rokgem=.FALSE.
ma_flag_gemlite=.FALSE.
ma_flag_ecogem=.FALSE.
# *******************************************************************
\end{verbatim}\vspace{-2pt}\normalsize

\noindent Note that \textbf{ATCHEM} and \textbf{BIOGEM} have to be selected together, as do \textbf{SEDGEM} and \textbf{ROKGEM} (if you want an 'open system because \textbf{ROKGEM} provides the weathering input). \textbf{ECOGEM} is a replacement for the implicit biological export scheme in \textbf{BIOGEM} and hence requires \textbf{BIOGEM} to be selected (and hence also \textbf{ATCHEM}). If you want the \textbf{ECOGEM} marine ecosystem model, set \texttt{ma\_flag\_ecogem=.TRUE.}

\vspace{1mm}
\noindent\rule{4cm}{0.5pt}
\vspace{2mm}

%------------------------------------------------
\newpage 
%------------------------------------------------
%
\subsubsection{2. Choosing a template \textit{user-config}}

The final file creation step is for/of a \textit{user-config} file. Once again -- you could take a published configuration from one of the \textsf{\footnotesize genie-userconfigs/MS} sub-directories or an EXAMPLE, copy and rename it and then edit in any changes you need.

A series of template \textit{user-config} files, some directly derived from published configurations (esp. for the MODERN \textit{user-configs}), are also provided as part of the \textbf{muffingen} release. Where alternative parameter choices exist in the \textit{user-config}, these are highlighted and commented out (\#\#\#).

Also in the MODERN template \textit{user-configs}, are some suggestions to parameter changes that align the MODERN \textit{user-configs} with the corresponding PALEO \textit{user-configs} (where a correspondence exists). These suggested alternative parameter choices are also included commented out (\#\#\#) and are:

\begin{itemize}[leftmargin=0.6in]
\vspace{1mm}
\item[--] Under \texttt{*** REMINERALIZATION ***}:
\small\vspace{-1mm}\begin{verbatim}
#### set 'instantaneous' water column remineralziation
###bg_par_bio_remin_sinkingrate_physical=9.9E9
###bg_par_bio_remin_sinkingrate_reaction=125.0
\end{verbatim}\vspace{-1mm}\normalsize
which enables instantaneous water-column remineralization of POM -- see \linebreak \textsf{\footnotesize USERCONFIG.PALEO.BIOGEM.PO4.SPIN} for a full description.
\vspace{1mm}
\item[--] Under \texttt{*** MISC ***}:
\small\vspace{-1mm}\begin{verbatim}
#### maximum time-scale to geochemical reaction completion (days)
###bg_par_bio_geochem_tau=90.0
#### extend solubility and geochem constant T range (leave S range as default)
###gm_par_geochem_Tmin  = -2.0
###gm_par_geochem_Tmax  = 45.0
###gm_par_carbchem_Tmin = -2.0
###gm_par_carbchem_Tmax = 45.0
\end{verbatim}\vspace{-1mm}\normalsize
The first of these imposes a maximum reactant uptake time-scale. The second extends the temperature limits imposed on gas solubility and carbonate chemistry dissociation parameters. See: \textsf{\footnotesize USERCONFIG.PALEO.BIOGEM.PO4.SPIN} for a full description.
\end{itemize}

\vspace{1mm}
In  all the PALEO templates, a series of recommendations are made that differ from some of the defaults in the MODERN template \textit{user-configs}. These include changes to:
\begin{itemize}[leftmargin=0.6in]
\item[1.] biological scheme
\item[2.] inorganic matter export ratios
\item[3.] water column remineralization
\item[4.] reactant consumption limitation
\item[5.] extended temperature ranges of solubility and geochemistry constants
\end{itemize}
These are all described in detail for \textsf{\footnotesize USERCONFIG.PALEO.BIOGEM.PO4.SPIN}.
\\\noindent As mentioned above -- the same/similar settings also appear in the MODERN templates (but commented out) should one which to align all the model assumptions across model and paleo applications.

\vspace{2mm}

The provided template \textit{user-config} files are:

\begin{itemize}[noitemsep]

\vspace{2mm}
\item \textsf{\small USERCONFIG.ABIOTIC.TRACER.SPIN}
\vspace{1mm}
\\This is as very basic template for an ocean (and atmosphere) with no carbon cycle.
\\You might use or adapt this if you were only interested in questions of ocean circulation and climate, although even then, you might want to add an age tracer to the ocean\footnote{If so, un-comment the 'optional' parameter setting.} (see HOW-TO on diagnosing how the model works).\\While the template \textit{user-config} could be used with any degree of complexity of tracers, it is designed for use with \textsf{\footnotesize TRACERCONFIG.ABIOTIC.txt}, with or without the 3rd tracer in the \textit{base-config} needed for diagnosing ventilation age: \texttt{gm\_ocn\_select\_48=.true.}

\vspace{2mm}
\item \textsf{\small USERCONFIG.MODERN.BIOGEM.PO4.SPIN}
\vspace{1mm}
\\This provides the \textit{user-config} parameter settings for the pre-industrial \textit{spin-up} experiment described in \textit{Cao et al.} [2009], as well as, commented-out, the settings for the configuration of \textit{Ridgwell et al.} [2007]. (The differences in parameters primarily relate to the two difference vertical resolutions and the calibrations performed on them.) Refer to the EXAMPLES for e.g. the parameter changes needed to the \textit{Cao et al.} [2009] historical transient experiment.
\\Suitable template tracer sets include: \textsf{\footnotesize TRACERCONFIG.Ridgwelletal.2007.txt} and \linebreak \textsf{\footnotesize TRACERCONFIG.Caoetal.2009.txt}, depending on whether you intend to make use of the additional diagnostic ocean circulation tracers or not.

\vspace{2mm}
\item \textsf{\small USERCONFIG.MODERN.BIOGEM.PO4Fe.SPIN}
\vspace{1mm}
\\This provides the \textit{user-config} parameter settings for a modern (pre-industrial) marine iron cycle (biological productivity limited by both \(PO_{4}\) and \(Fe\)). It is based on a configuration used by \textit{Odalen et al.} [2019] as well as in \textit{Tagliabue et al.} [2016] and was calibrated for the \texttt{worjh2} world configuration. An alternative set of biological uptake and \(Fe\) cycle parameters are provided (commented out) which are also in use [unpublished work] and was calibrated for the \texttt{worlg4} world configuration.
\\Suitable template tracer sets include: \textsf{\footnotesize TRACERCONFIG.Odalenetal.2019.txt} and \linebreak \textsf{\footnotesize TRACERCONFIG.Wardetal.2018.txt}, depending on the \(Fe\) tracer scheme selected.

\vspace{2mm}
\item \textsf{\small USERCONFIG.MODERN.ECOGEM.PO4Fe.SPIN}
\vspace{1mm}
\\This is basically, the \textit{user-config} for the modern \textbf{ECOGEM} experiment following \textit{Ward et al.} [2018] and bar some comments and tidying up is the same as \textsf{\footnotesize wardetal.2018.ECOGEM.SPIN} that can be found in \textsf{\footnotesize genie-userconfigs/MS/wardetal.2018}.
\\The only difference are a couple of optional suggestions that will align the configuration with the corresponding recommended paleo configurations (in addition to the POM remineralization and geochemical constant temperature range suggestions listed earlier):
\vspace{1mm}
\begin{itemize}[noitemsep]
\item Under \texttt{*** REMINERALIZATION ***}:
\small\vspace{-1mm}\begin{verbatim}
#### DOC lifetime (yrs) -- following Doney et al. [2006]
###bg_par_bio_remin_DOMlifetime=0.5
\end{verbatim}\vspace{-1mm}\normalsize
which aligns the lifetime of DOM with the \textit{Doney et al.} [2006] value adopted in the original \textbf{BIOGEM} configuration.
\vspace{1mm}
\item Under \texttt{*** MISC ***}:
\small\vspace{-1mm}\begin{verbatim}
#### add seaice attenuation of PAR
###eg_ctrl_PARseaicelimit=.true.
#### relative partitioning of C into DOM
###eg_par_beta_POCtoDOC=0.70
\end{verbatim}\vspace{-1mm}\normalsize
which firstly limits light available under sea-ice in proportion to the fractional sea-ice cover in that grid cell, and secondly, re-partitions carbon from POM to DOM and is tuned to produce an approximately Redfield ratio (\(106\)) of \(104.7:1\) in \(C:P\) of exported POM.
\end{itemize}
The intended corresponding template tracer is: \textsf{\footnotesize TRACERCONFIG.Wardetal.2018.txt}.

\vspace{2mm}
\item \textsf{\small USERCONFIG.PALEO.BIOGEM.PO4.SPIN}
\vspace{1mm}
\\This is a recommended template \textit{user-config} for paleo applications. Several parameters have been changed or added compared to published paleo configurations (these recommendations need not be adopted and alternatives are given commended out in the file):
\begin{enumerate}[noitemsep]
\vspace{1mm}
\item \textbf{biological scheme}
\small\vspace{-1mm}\begin{verbatim}
# biological scheme ID string
bg_par_bio_prodopt="bio_P"
# biological uptake time-scale
bg_par_bio_tau=63.3827
# [PO4] M-M half-sat value (mol kg-1)
bg_par_bio_c0_PO4=0.10E-06
\end{verbatim}\vspace{-1mm}\normalsize
This differs from most of the published paleo applications in that it has a biological export scheme that is temperature-dependent and more responsive to changes in ocean \(PO_{4}\) inventory (a similar configuration was used by \textit{Meyer et al.} [2016]).
\vspace{1mm}
\item \textbf{inorganic matter export ratios}
\\While it would be perfectly acceptable to utilize the default carbonate saturation-dependent scheme for the ratio of exported \(CaCO_{3}\) compared to \(POC\) (see Ridgwell et al. [2007, 2009]), published paleo implementations of \textbf{muffin} have tended to utilize a simple spatially uniform and invariant with time, \(CaCO_{3}:POC\) ratio. This is enacted via:
\small\vspace{-1mm}\begin{verbatim}
# fixed CaCO3:POC
bg_opt_bio_CaCO3toPOCrainratio='FIXED'
# underlying export CaCO3 as a proportion of particulate organic matter
bg_par_bio_red_POC_CaCO3=0.200
\end{verbatim}\vspace{-1mm}\normalsize
with the first parameter specifying a fixed and invariant ratio, and the second parameter specifying what the ratio actually is. As an alternative to the first parameter, one can set the power in the carbonate saturation parameterization, to zero, i.e.:
\small\vspace{-1mm}\begin{verbatim}
# exponent for modifier of CaCO3:POC export ratio
bg_par_bio_red_POC_CaCO3_pP=0.0
\end{verbatim}\vspace{-1mm}\normalsize
The default/recommended paleo value of \(0.2\) derives from the model-data analysis of \textit{Panchuk et al.} [2008], and as such is both subject to the specific caveats of that study, and may not necessarily be appropriate for later in the Cenozoic (or earlier in the Mesozoic).
\\For deeper time -- prior to ca. the mid Mesozoic -- the recommended parameter value is \(0.0\), on the basis that pelagic calcifiers had not yet evolved and the surface ocean export of biogenic \(CaCO_{3}\) is effectively zero -- e.g. see \textit{Ridgwell} [2005].
\vspace{1mm}
\item \textbf{water column remineralization}
In the default and previously published (in all applications) remineralization scheme, particulate matter only sinks a finite distance each time-step. At the next time-step, it starts from the ocean layer it reaches and sinks further (determined by the default sinking rate of \(125\:m\:d^{-1}\))\footnote{It always has to travel at least 1 ocean layer downwards on each time-step -- more for faster sinking rates and/or thinner layers nearer the surface.)}. This can make it difficult to e.g. check flux mass balances because there is a lag between export and particulate matter reaching the sediment surface.
\\Alternatively, a 'cleaner' approach is to instantaneously remineralize all particulate organic matter throughout the water column according to the remineralization profile and/or reaction rates. This is activated via \texttt{bg\_par\_bio\_remin\_sinkingrate\_physical} which is simply assigned a very 'large'\footnote{Sufficient that the deepest ocean model layer can be reached within a single time-step.} value for the sinking rate. At the same time, reaction rates (including scavenging) are calculated as if the sinking rate was finite and equivalent to the value of \texttt{bg\_par\_bio\_remin\_sinkingrate\_reaction} (\(m\:d^{-1}\)). Hence:
\small\vspace{-1mm}\begin{verbatim}
# set 'instantaneous' water column remineralziation
bg_par_bio_remin_sinkingrate_physical=9.9E9
bg_par_bio_remin_sinkingrate_reaction=125.0
\end{verbatim}\vspace{-1mm}\normalsize
\vspace{1mm}
\item \textbf{reactant consumption limitation}
\\It is good practice not to allow complete consumption of any particular reactant by a single reaction. This is because multiple processes may be competing for the same reactant, whilst at the same time, ocean circulation is transporting the reactant away. The result can be (small) negative tracer values.
\small\vspace{-1mm}\begin{verbatim}
# maximum time-scale to geochemical reaction completion (days)
bg_par_bio_geochem_tau=90.0
\end{verbatim}\vspace{-1mm}\normalsize
By setting the value of \texttt{bg\_par\_bio\_geochem\_tau}\footnote{By default it is set to zero which is interpreted as allowing complete reactant consumption as per previously.}, the maximum consumption of any particular reactant by a single reaction is limited by an imposed lifetime (days). Here, the value is set to \(90\:d\).
\vspace{1mm}
\item \textbf{extended temperature ranges of solubility and geochemistry constants}
\\As described in \textit{Ödalen et al.} [2018]: "The dissociation constants used in the cGENIE calculations of solubility for \(CO_{2}\) in seawater follow \textit{Mehrbach et al.} [1973], which are only defined for waters between \(2\) and \(35^{\circ}C\). Hence, the expression for \(CO_{2}\) solubility in the model is restricted so that all water below \(2^{\circ}C\) has the same \(CO_{2}\) solubility (similarly for all water above \(35^{\circ}C\))."
\\The recommended parameter changes:
\small\vspace{-1mm}\begin{verbatim}
# extend solubility and geochem constant T range (leave S range as default)
gm_par_geochem_Tmin  = -2.0
gm_par_geochem_Tmax  = 45.0
gm_par_carbchem_Tmin = -2.0
gm_par_carbchem_Tmax = 45.0
\end{verbatim}\vspace{-1mm}\normalsize
extend the valid range to \(-2 - 45^{\circ}C\). Note that the valid salinity range is left unchanged.
\end{enumerate}

\vspace{1mm}
Finally, it should be noted that the parameter settings for activating temperature-dependent remineralization (as per \textit{John et al.} [2014] and \textit{Crichton et al.} [2020]) are given (and commented out (\#\#\#)):
\small\vspace{-1mm}\begin{verbatim}
# *** Crichton et al. [2020] temperature-dependent remin ************
###bg_ctrl_bio_remin_POC_fixed=.false.
###bg_par_bio_remin_POC_K1=9.0E11
###bg_par_bio_remin_POC_Ea1=54000.0
###bg_par_bio_remin_POC_K2=1.0E14
###bg_par_bio_remin_POC_Ea2=80000.0
###bg_par_bio_remin_POC_frac2=0.008
\end{verbatim}\vspace{-1mm}\normalsize
Note that in \textit{Crichton et al.} [2020], a different biological scheme is used, with a faster time-scale of nutrient uptake (but different light limitation) -- also given commented out in the \textit{user-config}\footnote{There is no strict necessity to use the alternative biological export scheme.}.

\vspace{2mm}
\item \textsf{\small USERCONFIG.PALEO.BIOGEM.PO4Fe.SPIN}
\vspace{1mm}
\\This is very similar to \textsf{\footnotesize USERCONFIG.PALEO.BIOGEM.PO4.SPIN}, with the exception that it adds iron co-limitation of biological productivity and a marine iron cycle to the \(PO_{4}\)-only paleo settings, including the recommend changes to sinking and water column remineralziation, reaction completion time-scales, and gas solubility.
\\A simplified 2-tracer (\(TDFe\), \(TL\)) iron system is assumed:
\small\vspace{-1mm}\begin{verbatim}
# iron tracer scheme
# NOTE: the base-config requires TFe and TL tracers
bg_opt_geochem_Fe='hybrid'
\end{verbatim}\vspace{-1mm}\normalsize
while the solubility and iron scavenging rates  come from from the \texttt{worjh2} calibrated configuration (see: \textsf{\footnotesize USERCONFIG.MODERN.BIOGEM.PO4Fe.SPIN}).
\\The only particularly novel addition, is that of a fake and globally uniform dust field in order to supply dissolved iron to the ocean surface:
\small\vspace{-1mm}\begin{verbatim}
bg_par_forcing_name="pyyyyz.RpCO2_Rp13CO2.DUST"
\end{verbatim}\vspace{-1mm}\normalsize
This is configured to give the same total dust supply to the ocean surface as per in the dust field used in \textit{Ward et al.} [2018], but is supplied evenly across the global ocean surface.
\\Note that there is no (\textit{user-config}) scaling parameter for sediment flux forcings and hence the total flux forcing appear explicitly in the time-series file: \textsf{\footnotesize biogem\_force\_flux\_sed\_det\_sig.dat}.
\\Also note that for a different total ocean area, the flux per \(m^{-2}\) will change as only the global total flux to the ocean surface is conserved.

\vspace{2mm}
\item \textsf{\small USERCONFIG.PALEO.ECOGEM.PO4.SPIN}
\vspace{1mm}
\\This is based on the configurations published by \textit{Wilson et al.} [2019], with iron quotas and usage disabled in \textbf{ECOGEM}.
\\In its modern tuning, \textbf{ECOGEM} has a high carbon export and high \(C/P\) ratio. This leads to a less well oxygenated modern ocean than observations. In removing iron and configuring \(PO_{4}\) as the sole limiting nutrient for paleo experiments where the dust flux field is not \textit{a priori} known, the \(C/P\) ratio increases still further and with it, a further depletion of ocean oxygen. This situation is rectified for paleo applications (under '\texttt{recommended}') by:
\begin{enumerate}[noitemsep]
\vspace{1mm}
\item \textbf{diagnosing, not applying a mixed layer}
\small\vspace{-1mm}\begin{verbatim}
# set mixed layer to be only diagnosed (for ECOGEM)
go_ctrl_diagmld=.true.
\end{verbatim}\vspace{-1mm}\normalsize
and
\vspace{1mm}
\item \textbf{re-partitioning carbon from POM to DOM}
\\(leaving nutrients etc. unchanged):
\small\vspace{-1mm}\begin{verbatim}
# relative partitioning of C into DOM
eg_par_beta_POCtoDOC=0.70
\end{verbatim}\vspace{-1mm}\normalsize
The alternative calibrated value is given should \(Fe\) limitation is included. For dust and aeolian iron supply, simply follow the instructions and parameter values for \linebreak \textsf{\footnotesize USERCONFIG.PALEO.BIOGEM.PO4Fe.SPIN}.
\end{enumerate}
In addition:
\begin{enumerate}[noitemsep]
\setcounter{enumi}{2}
\vspace{1mm}
\item \textbf{sea-ice light limitation}
The original \textbf{ECOGEM} model did not include any limitation of biological productivity by sea-ice cover. This is included now by:
\small\vspace{-1mm}\begin{verbatim}
# add seaice attenuation of PAR
eg_ctrl_PARseaicelimit=.true.
\end{verbatim}\vspace{-1mm}\normalsize
which reduces light proportionally to the local fractional sea-ice cover.
\end{enumerate}
Additional recommend changes for sinking and water column remineralziation, reaction completion time-scales, and gas solubility, are the same as per for the \textbf{BIOGEM} PALEO template \textit{user-configs}, described previously.

\end{itemize}

%------------------------------------------------
%
\subsubsection{3. Ensuring files are in their correct location and parameter settings are consistent}

\begin{enumerate}[noitemsep]
\vspace{1mm}
\item First, ensure that you have remembered to copy/transfer the entire configuration file subdirectory created by \textbf{muffingen}\footnote{Which by default will appear in a directory: \textsf{\footnotesize INPUT.EXAMPLES}} to: \textsf{\footnotesize cgenie.muffin/genie-paleo}.
\vspace{1mm}
\item Next, your new \textit{base-config} will need to be transferred to: \textsf{\footnotesize cgenie.muffin/genie-main/configs}.
\\Ensure that it has a \textsf{\footnotesize .config} file extension.
\vspace{1mm}
\item Your \textit{user-config} can go 'anywhere' ... ish. Putting it directly in \textsf{\footnotesize genie-userconfigs}\footnote{The directory parameter passed to \textsf{\footnotesize runmuffin.sh} is then just \texttt{/}} may eventually make things over-crowded. Better is to create a sub-directory of \textsf{\footnotesize genie-userconfigs} (or even a sub-directory of this) and place it there \footnote{If you place the \textit{user-config} file into a sub-directory  \textsf{\footnotesize myexperiments}, the directory parameter passed to \textsf{\footnotesize runmuffin.sh} is then \texttt{myexperiments}} or simply in: \textsf{\footnotesize genie-userconfigs/LABS}
\vspace{1mm}
\item Checking the consistency between the tracers defined in the \textit{base-config} and the experiment parameter requested in the \textit{user-config} is the trickiest part. Refer to some of the published configurations (best) and/or EXAMPLES for guidance.
\vspace{1mm}
\\Remember that if you don't want any additional tracers, the tracer total line in the \textit{base-config} should be:
\\\texttt{\small GOLDSTEINNTRACSOPTS='\$(DEFINE)GOLDSTEINNTRACS=2'}
\vspace{1mm}
\\If you want a single color (age) tracer, you need:
\\\texttt{\small GOLDSTEINNTRACSOPTS='\$(DEFINE)GOLDSTEINNTRACS=3'}
\\\uline{and} the additional line:
\\\texttt{\small gm\_ocn\_select\_48=.true.     \#   colr -- 'RED numerical (color) tracer'} 
\vspace{1mm}
\\ Sometimes it is best simply to start the experiment running and see what happens -- there are checks (not comprehensive) in the code to see if you have the necessary tracers selected. Read any warnings that are reported as the experiment initializes, but often you can ignore these.
\\\uline{Ensure} that the total number of defined tracers equals the number of selected tracers you have listed (plus temperature and salinity) in the \textit{base-config.}
\vspace{1mm}
\item Finally, if you have previously run an experiment using a different \textit{base-config}, you will need to briefly interactively run an experiment with the new \textit{base-config} in order that \textbf{muffin} knows to re-compile. (Remember that you cannot go directly to submitting jobs to the cluster when changing \textit{base-configs}.)
\end{enumerate}

\vspace{2mm}
Good luck!

%------------------------------------------------
%------------------------------------------------

\newpage

\section{muffingen parameter settings -- details}

%------------------------------------------------

\subsubsection{Zonal wind-stress}

For non GCM-based configurations, no prior wind fields exist. \textbf{muffingen} hence creates and configures an idealized zonal wind-stress field (from which wind velocity and wind speed is derived). The zonal wind-stress can take alternative strengths, depending on whether a high latitude gateway (in either hemisphere) exists. This can be prescribed directly, or \textbf{muffingen} can be enabled to 'choose' whether or not a high latitude gateway exists and hence whether or not to apply a strong or weak zonal flow. The parameter options (in the \textbf{muffingen} configuration file) are:

\vspace{1mm}
\begin{itemize}
\item \texttt{par\_tauopt=0;}
\\\textbf{muffingen} chooses whether or not to apply a strong or weak zonal flow, and in which hemisphere, depending on whether it thinks a high-latitude gateway exists or not.
\item \texttt{par\_tauopt=1;}
\\A weak zonal flow is applied in both hemispheres (e.g. assuming land prevents the existence of an ocean-only circumpolar high latitude pathway  in both hemispheres).
The presence of a pole-to-pole super-continent (or 'ridge-world') would be an example of when this option might be selected\footnote{But note that in the ridgeworld EXAMPLE provided, the automatic assignment option (\#0) is instead set to be consistent with the series of fake .dat based configurations.)}.
\item \texttt{par\_tauopt=2;}
\\A strong zonal flow is applied in both hemispheres (e.g. assuming there is no land to prevent the existence of an ocean-only circumpolar high latitude pathway  in both hemispheres). The presence of an Equatorial-only super-continent (or 'water-world') would be an example of when this option might be selected\footnote{But note that in the waterworld EXAMPLE provided, the automatic assignment option (\#0) is instead set to be consistent with the series of fake .dat based configurations.)}.
\item \texttt{par\_tauopt=3;}
\\'grey' world -- an intermediate strength zonal flow is applied in both hemispheres. For hedging your bets of for use across a wide range of different continental configuration where you do not want to manually chose and prescribe either strong (\texttt{2}) or weak (\texttt{1}) and don't dare trust \textbf{muffingen} to make the choice for you (option \texttt{0}).
\end{itemize}
\vspace{1mm}

For reference -- the modern world has a mix of strong (southern) and weak (northern) hemisphere zonal flows.

The different \textsf{\footnotesize EXAMPLE} (\textsf{\footnotesize .m}) configuration files have a mixture of default choices, for example (not exhaustively listing all the different example configurations ...):

\vspace{1mm}
\begin{itemize}
\item \textsf{\footnotesize EXAMPLE\_MASK\_drakeworld}, \textsf{\footnotesize EXAMPLE\_MASK\_eqpasworld}, etc.:
\\\texttt{par\_tauopt=0;}\footnote{Note that some of these could be pre-determined -- e.g. water-world could be set with option \#2 (strong zonal winds), and ridge-world with \#1 (weak zonal winds). For configurations with a circumpolar passage only in one hemisphere such as drake-world, option \#0 will configure this with a weak northern zonal wind field and a strong southern one.}
\item \textsf{\footnotesize EXAMPLE\_K1\_permian}, \textsf{\footnotesize EXAMPLE\_K2\_supercontinent}:
\\\texttt{par\_tauopt=1}
\item (none of the current examples prescribe strong zonal winds, but could (see footnotes)):
\\\texttt{par\_tauopt=2}
\item \textsf{\footnotesize EXAMPLE\_BLANK}:
\\\texttt{par\_tauopt=3}\footnote{By default, a water world is created, which would normally be wind stress option \#2. However, assuming some unknown continental configuration may be drawn, the 'grey world' intermediate wind stress option is set (\#3).}
\item \textsf{\footnotesize EXAMPLE\_GCMHadCM3L\_modern}\normalsize, \textsf{\footnotesize EXAMPLE\_GCMFOAM\_modern}\normalsize:
\\n/a\footnote{(so any value can be set as it is ignored)} (wind-stress derived from GCM fields)
\end{itemize}
\vspace{1mm}

%------------------------------------------------

\subsubsection{Ocean depth (and maximum levels)}

The standard configurations of muffin assume a maximum ocean depth of 5000 m. (In fact, until recent code changes, the scale-depth in the \textbf{GOLDSTEIN} ocean model component was hard-coded as 5000.0 m.) This depth is then divided up into 16 (typically) or 8 ocean levels with a logarithmic distribution of ocean layer thicknesses.

The number of layers in the ocean is set by the parameter:

\vspace{1mm}
\texttt{par\_max\_k}
\vspace{1mm}

\noindent and the maximum (scale) depth is:

\vspace{1mm}
\texttt{par\_max\_D}
\vspace{1mm}

You need not have all \texttt{par\_max\_k} layers spread over depth \texttt{par\_max\_D}. You can specify the minimum (deepest) depth level used in the muffin depth grid via the parameter:

\vspace{1mm}
\texttt{par\_min\_k}
\vspace{1mm}

\noindent By default this has a value of \texttt{1}. Setting a high value truncates the ocean floor. e.g. for a flat-bottom ocean, a common value is \texttt{3}, meaning that the ocean model consists only of layers 16 down through 3, giving it a maximum depth of about 3500 m. This, in conjunction with a modern-like land fraction, gives a modern-like ocean volume (given that the modern ocean has an average seafloor depth of ca. 3500 m).

If you require a deeper (maximum depth) ocean than 5000 m, be aware that retaining the same (e.g. 16) value of \texttt{par\_max\_k} means that that the same number of ocean layers are distributed over the greater ocean depth, and hence, your surface layer will be deeper, potentially changing biological productivity and biogeochemical cycling. There is hence a facility provided for maintaining the thickness depth distribution in the upper ocean while adding additional layers to the bottom of the ocean to create a greater (than 5000.0) maximum ocean depth. This is implemented by setting the parameter:

\vspace{1mm}
\texttt{par\_add\_Dk}
\vspace{1mm}

\noindent (the additional number of depth (k) levels) to a non-zero value. The effect of this is assume that the maximum ocean depth parameter (\texttt{par\_max\_D}) corresponds to the specified maximum number of ocean layers (\texttt{par\_max\_k}) minus the number of additional layers (\texttt{par\_add\_Dk})\footnote{(rather than the maximum number of ocean levels as usually applied)}.  The maximum ocean depth is then re-calculated based on \texttt{par\_max\_k} minus \texttt{par\_add\_Dk} number of levels, corresponding to depth \texttt{par\_max\_D} (with the same logarithmic distribution of layer thicknesses with ocean depth applied to the additional layers deeper than \texttt{par\_max\_D}).

For example, setting:

\vspace{1mm}
\texttt{par\_add\_Dk=2}
\vspace{1mm}

\noindent in conjunction with a total number of ocean levels:

\vspace{1mm}
\texttt{par\_max\_k=18}
\vspace{1mm}

\noindent and:

\vspace{1mm}
\texttt{par\_max\_D=5000.0}
\vspace{1mm}

\noindent together configures an 18-level ocean model with the first 16 (18-2=16) levels spanning  5000.0 m, with an automatically re-calculated maximum ocean depth (\texttt{par\_max\_D} value) of 6922.2705 m and the additional 2 levels spanning this additional depth (1922.2705 m).\footnote{Note that there is no way, unless the logarithmic function for the distribution of layer thicknesses with ocean depth is changed, to retain the same modern/default  layer thickness distribution for the upper ocean layers and have a maximum ocean depth that is different to 5000.0 m unless you carry out the calculation yourself for the depth occupied by e.g. 18 levels. (You cannot calculate how many layers occupies e.g. 6000.0 m and still retain the upper ocean depth distribution as the depth profile does not fit neatly into 6000.0 m.)}

When \textbf{muffingen} writes out the parameter settings (file: \textsf{\footnotesize config\_??????.txt}), the scale depth of the ocean is also written out. By default this will be equal to the value of \texttt{par\_max\_D} (5000.0 m), \uline{unless}, the value of \texttt{par\_add\_Dk} is non-zero, when the above described re-calculation of the maximum ocean depth is made (and written out in the parameter file).

%----------------------------------------------------------------------------------------
%----------------------------------------------------------------------------------------